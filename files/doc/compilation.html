
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <title>Compiling MTEX (DocHelp Toolbox)
         
      </title>
      <!-- DOCNAME: DocHelp Toolbox -->
      <meta name="chunktype" content="refpage">
      <!-- CHUNKNAME: compilation -->
      <!-- HEADSTUFF: compilation -->
      <!-- HEADSTUFF -->
      <meta name="refentity" content="method:compilation">
      <meta http-equiv="Content-Script-Type" content="text/javascript">
      <meta name="toctype" content="fcn">
      <link rel="stylesheet" href="up.css"><script language="JavaScript" src="docscripts.js"></script></head>
   <body><a name="top_of_page"></a><div class="navbar navbar-inverse navbar-fixed-top">
         <div class="navbar-inner">
            <div class="container"><a class="brand" href="/">MTEX Toolbox</a><ul class="nav">
                  <li><a href="/download.html">Downloads</a></li>
               </ul>
               <ul class="nav">
                  <li><a href="/documentation.html">Documentation</a></li>
               </ul>
               <ul class="nav">
                  <li><a href="/team.html">People</a></li>
               </ul>
               <ul class="nav">
                  <li><a href="/publications.html">Publications</a></li>
               </ul>
               <ul class="nav">
                  <li><a href="/support.html">Support</a></li>
               </ul>
            </div>
         </div>
      </div>
      <div class="container">
         <h1>Compiling MTEX</h1>
         <div class="subheading">
            <p>Explains how to compile MTEX on Mac, Linux, and Windows systems. This should not be necessary in most cases.</p>
         </div>
         <h2>Introduction<a name="1"> </a></h2>
         <p>MTEX is shipped with precompiled binaries for macOS, Windows, and Linux for 64-bit systems. However, if these binaries are
            for some reason not compatible with your system, you have to compile them by hand. Compiling MTEX is not that easy and you
            are encouraged to contact the author if you have any problem.
         </p>
         <h2>Pre-requisites<a name="2"> </a></h2>
         <p><b>Compiler</b></p>
         <p>In order to install the MTEX toolbox you will have to compile it. Therefore you need a standard C compiler <a href="http://gnu.gcc.org">gcc</a> and the <b>make</b> utility. You may also need the package named <b>build-essentials</b>. Under Linux and MAC OSX all these components can be easily installed using  your favorite package manager. For Windows,
            we recommend the usage of MinGW and MSYS.
         </p>
         <p><b>FFTW</b></p>
         <p>The FFTW is one of the most popular fast Fourier transform libraries. For Linux and Mac OSX pre-compiled packages are available
            through your favorite package manager. The package is called fftw3 or similar. You will also need to install  the header (developer)
            files. Alternatively, you can download the latest source directly from <a href="http://www.fftw.org">http://www.fftw.org</a> and compile it on your computer. For Windows, this is the only way to go. Download the source code and compile it using MinGW.
         </p>
         <h2>Compiling binaries<a name="3"> </a></h2>
         <p><b>NFFT</b></p>
         <p>The NFFT is a C library for nonequispaced fast Fourier transforms including Fourier transforms on the sphere: <a href="http://www-user.tu-chemnitz.de/~potts/nfft">http://www-user.tu-chemnitz.de/~potts/nfft</a>. For now, you will need the current development version (<a href="https://github.com/NFFT/nfft">https://github.com/NFFT/nfft</a>). To build and install the nfft binaries, you can use the following steps:
         </p>
         <div>
            <ul type="square">
               <li><tt>cd nfft_download_directory</tt></li>
               <li><tt>./bootstrap</tt></li>
               <li><tt>./configure --with-matlab=MATLAB_DIR --enable-nfsoft --enable-nfsft --enable-portable-binary</tt></li>
               <li><tt>make</tt></li>
			</ul>
         </div>
		 <p>Now copy the following files to your mtex/extern/nfft directory: <tt>nfft/matlab/nfsoft/nfsoftmex.mex* nfft/matlab/nfsoft/nfsftmex.mex* </tt> </p>
		 <p>In case you want to use openMP support, install the openMP libraries for your operation system, make sure your compiler supports openMP and add <tt>--enable-openmp</tt> as a configure option. For additional configure options, have a look at <tt> ./configure --help </tt>. </p>
         <p><b>Portable binaries for macOS</b></p>
         <p> In case you use macOS and you want to compile statically linked, portable nfft binaries, including openMP support, install gcc and libtool i.e. via <a href="https://brew.sh/">brew</a>. In the following example gcc 8.2 and Matlab 2018b is used.  </p>
         <p>
         <div>
            <ul type="square">
				<li><tt>brew install gcc libtool</tt></li>
				<li><tt>cd nfft_download_directory</tt></li>
				<li><tt>./bootstrap</tt></li>
				<li><tt>CC=/usr/local/Cellar/gcc/8.2.0/bin/gcc-8 LDFLAGS=-Wl,-L/usr/local/Cellar/gcc/8.2.0/lib/gcc/8 ./configure --with-matlab=/Applications/MATLAB_R2018b.app --enable-nfsoft --enable-nfsft --enable-openmp --enable-portable-binary --with-apple-gcc-arch=x86_64 </tt></li>
				<li><tt>make</tt></li>
			</ul>
         </div>
         <p> Now create, make it executable and run the following shell script: </p>
		 <p>
         <p><tt>CC=/usr/local/Cellar/gcc/8.2.0/bin/gcc-8<br /> 
			MATLABDIR=/Applications/MATLAB_R2018b.app<br /> 
			for LIB in nfsft nfsoft<br /> 
			do<br /> 
				cd matlab/"$LIB"<br /> 
				"$CC"  -o .libs/lib"$LIB".mexmaci64 -bundle .libs/lib"$LIB"_la-"$LIB"mex.o -Wl,-force_load,../../.libs/libnfft3_matlab.a \<br /> 
				-Wl,-force_load,../../matlab/.libs/libmatlab.a -L"$MATLABDIR"/bin/maci64 -lm -lmwfftw3 -lmx -lmex -lmat  -fopenmp -O3 \<br />
				-malign-double -march=core2 -arch x86_64 -fopenmp -static-libgcc<br /> 
				cp .libs/lib"$LIB".mexmaci64 "$LIB"mex.mexmaci64<br /> 
				cd ../..<br /> 
			done</tt></p>

		 <p> Once completed without errors, copy the <tt>.mexmaci64</tt> files from <tt>./matlab/nfsoft/</tt> and <tt>./matlab/nfsft/</tt> to your mtex installation (<tt>mtex/extern/nfft_openMP/</tt>).</p>
		 <p>	 
         <p><b>Additional binaries</b></p>
         <p>The following steps should usually happen automatically during <tt>startup_mtex</tt>, however in case this fails for any reason, this is done by:</p>
         <div>
            <ul type="square">
               <li><tt>cd mtex_download_directory/mex</tt></li>
               <li><tt>mex_install</tt> (from within Matlab) </li>
               or
               <li> edit the Makefile according to your operation system and run </li>
               <li><tt>make</tt></li>
            </ul>
         </div>
         <h2>Checking Your Installation<a name="4"> </a></h2>
         <p>After the next start of MATLAB change to the MTEX path and enter</p>
         <div>
            <ul type="square">
               <li><tt>startup_mtex</tt></li>
            </ul>
         </div>
         <p>This should startup the MTEX toolbox and usually everything is checked during startup. You can check your installation under MATLAB by typing</p><pre class="codeinput">check_mtex</pre><pre class="codeoutput">
checking MTEX installation
this might take some time
 
simulating pole figures
 
pf = PoleFigure  
  crystal symmetry : m-3m
  specimen symmetry: 222
 
  h = (100), r = 1 x 206 points
  h = (110), r = 1 x 206 points
  h = (111), r = 1 x 206 points
  h = (211), r = 1 x 206 points
 
  0 |  0.33  0.23  0.28  0.11
  1 |  0.15  0.14  0.12  0.07
  2 |  0.11  0.10  0.08  0.05
  3 |  0.10  0.08  0.07  0.04
  4 |  0.08  0.07  0.06  0.03
  5 |  0.07  0.06  0.05  0.03
  6 |  0.06  0.05  0.04  0.02
  7 |  0.05  0.04  0.04  0.02
  8 |  0.05  0.04  0.04  0.02
  9 |  0.04  0.03  0.03  0.02
 10 |  0.04  0.  I'm going to apply ghost correction. Uniform portion fixed to 0.73
  0 |  0.77  0.63  0.71  0.36
  1 |  0.58  0.54  0.55  0.30
  2 |  0.47  0.47  0.44  0.25
  3 |  0.39  0.40  0.37  0.22
  4 |  0.33  0.35  0.31  0.19
  5 |  0.28  0.29  0.25  0.16
  6 |  0.23  0.24  0.20  0.13
  7 |  0.19  0.20  0.17  0.11
  8 |  0.16  0.17  0.14  0.09
  9 |  0.14  0.15  0.12  0.08
 10 |  0.13  0.14  0.11  0.08
 
rec = ODF  
  crystal symmetry : m-3m
  specimen symmetry: 222
 
  Uniform portion:
    weight: 0.73006
 
  Radially symmetric portion:
    kernel: de la Vallee Poussin, halfwidth 10°
    center: 95 orientations, resolution: 10°
    weight: 0.26994
 
 
check reconstruction error: 
progress: 100%
everythink seems to be ok!
Elapsed time is 1.490837 seconds.
</pre><p style="font-size:1px;"></p>
         <table class="footer" border="0" width="100%" cellpadding="0" cellspacing="0">
            <tr>
               <td valign="baseline" align="right">DocHelp 0.1 beta</td>
            </tr>
         </table><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83346204-1', 'auto');
  ga('send', 'pageview');

   </script></div>
   </body>
</html>
